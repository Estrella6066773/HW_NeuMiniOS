# 进程管理测试指南 - 学生B

## 📚 什么是进程管理？

### 简单理解
**进程管理**就像是操作系统的"任务管理器"。它负责：
1. **创建进程**：启动新程序（就像你双击一个程序图标）
2. **跟踪进程**：记录哪些程序正在运行
3. **停止进程**：关闭正在运行的程序
4. **查看进程列表**：显示所有正在运行的程序

### 在你的项目中
- **进程表**：一个数组，最多可以存储5个进程的信息
- **每个进程**包含：
  - `pid`：NeuMiniOS给你的进程编号（1, 2, 3...）
  - `system_pid`：Linux系统给的真实进程ID
  - `name`：进程名称（如"helloworld"）
  - `status`：状态（0=未使用，1=运行中）

---

## ✅ 项目运行状态

**✅ 项目已编译成功！** 可以运行了。

---

## 🚀 如何运行和测试

### 第一步：启动系统

```bash
cd /root/CLionProjects/HW_NeuMiniOS
./neuminios
```

**预期输出：**
```
========================================
    NeuMiniOS Boot Loader (NeuBoot)
========================================

Loading files from directory: ./neuminios_files
Loaded X files into Disk Image

=== Boot Information ===
Disk Image Size: XXX bytes

Files in Disk Image:
  [文件列表]

NeuMiniOS ready. Starting CLI...
Type 'exit' to quit

> 
```

---

## 🧪 进程管理功能测试步骤

### 测试1：查看初始进程列表（应该为空）

**输入：**
```
> plist
```

**预期输出：**
```
=== Running Processes (max 5) ===
PID        System PID Name                 Status
------------------------------------------------
```

**说明：** 此时没有运行任何进程，所以列表是空的。

---

### 测试2：运行一个程序（创建进程）

**输入：**
```
> run helloworld
```

**预期输出：**
```
[OK] Process 1 started (NeuMiniOS PID: 1, System PID: XXXX)
Hello World from NeuMiniOS!
```

**说明：**
- `Process 1`：NeuMiniOS给你的进程编号
- `System PID: XXXX`：Linux系统的真实进程ID
- `Hello World from NeuMiniOS!`：程序输出的内容

**✅ 成功标志：**
- 看到 `[OK] Process X started` 消息
- 看到程序的输出（Hello World）
- 没有错误信息

---

### 测试3：查看进程列表（应该显示1个进程）

**输入：**
```
> plist
```

**预期输出：**
```
=== Running Processes (max 5) ===
PID        System PID Name                 Status
------------------------------------------------
1          XXXX       helloworld           Running
```

**说明：**
- `PID 1`：NeuMiniOS进程ID
- `System PID XXXX`：Linux系统PID
- `helloworld`：进程名称
- `Running`：状态为运行中

**✅ 成功标志：**
- 能看到刚才启动的进程
- 显示正确的PID和名称

---

### 测试4：运行多个程序（测试进程表容量）

**输入：**
```
> run helloworld
> run helloworld
> run helloworld
> plist
```

**预期输出（plist后）：**
```
=== Running Processes (max 5) ===
PID        System PID Name                 Status
------------------------------------------------
1          XXXX       helloworld           Running
2          YYYY       helloworld           Running
3          ZZZZ       helloworld           Running
```

**✅ 成功标志：**
- 每个进程都有不同的PID（1, 2, 3...）
- 每个进程都有不同的System PID
- 最多可以运行5个进程

---

### 测试5：停止进程

**输入：**
```
> stop 1
```

**预期输出：**
```
[OK] Process 1 stopped
```

**说明：**
- 停止PID为1的进程
- 进程会被终止

**✅ 成功标志：**
- 看到 `[OK] Process X stopped` 消息
- 没有错误信息

---

### 测试6：验证进程已停止

**输入：**
```
> plist
```

**预期输出：**
```
=== Running Processes (max 5) ===
PID        System PID Name                 Status
------------------------------------------------
2          YYYY       helloworld           Running
3          ZZZZ       helloworld           Running
```

**说明：**
- PID 1 的进程已经不在列表中了
- 只剩下其他还在运行的进程

**✅ 成功标志：**
- 被停止的进程不再出现在列表中

---

### 测试7：测试进程表已满的情况

**先运行5个进程：**
```
> run helloworld
> run helloworld
> run helloworld
> run helloworld
> run helloworld
> plist  # 应该显示5个进程
```

**然后尝试运行第6个：**
```
> run helloworld
```

**预期输出：**
```
[ERROR] Process table full (max 5 processes)
```

**✅ 成功标志：**
- 正确显示错误信息
- 不会创建第6个进程

---

### 测试8：停止不存在的进程

**输入：**
```
> stop 999
```

**预期输出：**
```
[ERROR] Process 999 not found
```

**✅ 成功标志：**
- 正确显示错误信息

---

### 测试9：退出系统（清理所有进程）

**输入：**
```
> exit
```

**预期输出：**
```
Shutting down NeuMiniOS...
[INFO] All processes cleaned up
Goodbye!
```

**✅ 成功标志：**
- 所有进程被清理
- 系统正常退出

---

## 📋 完整测试流程示例

```bash
# 1. 启动系统
./neuminios

# 2. 查看文件列表
> list

# 3. 查看初始进程列表（应该为空）
> plist

# 4. 运行程序
> run helloworld

# 5. 再次查看进程列表（应该显示1个进程）
> plist

# 6. 再运行一个程序
> run helloworld

# 7. 查看进程列表（应该显示2个进程）
> plist

# 8. 停止第一个进程
> stop 1

# 9. 查看进程列表（应该只剩1个进程）
> plist

# 10. 退出系统
> exit
```

---

## 🎯 功能完成标准

### ✅ 基本功能（必须完成）

1. **`run` 命令**
   - ✅ 能够从磁盘镜像提取可执行文件
   - ✅ 能够创建新进程并运行程序
   - ✅ 能够显示进程创建成功消息
   - ✅ 能够显示程序输出

2. **`plist` 命令**
   - ✅ 能够显示所有运行中的进程
   - ✅ 显示格式正确（PID, System PID, Name, Status）
   - ✅ 空列表时显示空表（不报错）

3. **`stop` 命令**
   - ✅ 能够停止指定PID的进程
   - ✅ 能够显示停止成功消息
   - ✅ 停止后进程不再出现在plist中

4. **错误处理**
   - ✅ 进程表满时显示错误
   - ✅ 停止不存在的进程时显示错误

5. **系统清理**
   - ✅ 退出时清理所有进程

---

## 🔍 如何验证你的代码工作正常

### 检查点1：进程创建
- [ ] 输入 `run helloworld` 后，看到 `[OK] Process X started`
- [ ] 看到程序的输出（Hello World）
- [ ] 没有错误信息

### 检查点2：进程列表
- [ ] 输入 `plist` 后，能看到刚才创建的进程
- [ ] PID、System PID、Name都显示正确
- [ ] 状态显示为 "Running"

### 检查点3：进程停止
- [ ] 输入 `stop 1` 后，看到 `[OK] Process 1 stopped`
- [ ] 再次输入 `plist`，被停止的进程不再出现

### 检查点4：多进程管理
- [ ] 可以同时运行多个进程（最多5个）
- [ ] 每个进程都有不同的PID
- [ ] 可以单独停止某个进程

### 检查点5：错误处理
- [ ] 运行超过5个进程时显示错误
- [ ] 停止不存在的进程时显示错误

---

## 💡 进程管理的工作原理（简单解释）

### 1. 进程创建流程（`run` 命令）

```
用户输入: run helloworld
    ↓
1. 从磁盘镜像提取文件到临时位置 (/tmp/neumini_XXXXXX)
    ↓
2. 设置文件为可执行权限
    ↓
3. 使用 fork() 创建子进程
    ↓
4. 子进程使用 execl() 执行程序
    ↓
5. 父进程记录进程信息到进程表
    ↓
6. 返回进程ID给用户
```

### 2. 进程表结构

```
进程表（数组，最多5个）:
┌─────┬─────────────┬──────────────┬──────────┬────────┐
│ 槽位 │ NeuMiniOS PID │ System PID  │ Name     │ Status │
├─────┼─────────────┼──────────────┼──────────┼────────┤
│  0  │      1       │    12345     │ helloworld│   1    │
│  1  │      2       │    12346     │ helloworld│   1    │
│  2  │      0       │       0      │          │   0    │ ← 空闲
│  3  │      0       │       0      │          │   0    │ ← 空闲
│  4  │      0       │       0      │          │   0    │ ← 空闲
└─────┴─────────────┴──────────────┴──────────┴────────┘
```

### 3. 进程停止流程（`stop` 命令）

```
用户输入: stop 1
    ↓
1. 在进程表中查找PID=1的进程
    ↓
2. 找到后，使用 kill() 发送 SIGTERM 信号
    ↓
3. 使用 waitpid() 等待进程结束
    ↓
4. 更新进程状态为0（未使用）
    ↓
5. 显示成功消息
```

---

## 🐛 常见问题排查

### 问题1：`run` 命令没有反应
- **检查**：文件是否在 `neuminios_files/` 目录中
- **检查**：文件是否是可执行文件
- **检查**：文件系统模块是否正常工作

### 问题2：`plist` 显示空列表
- **可能原因**：进程已经执行完毕并退出
- **解决方法**：运行一个长时间运行的程序（如包含 `sleep` 的程序）

### 问题3：`stop` 命令无效
- **检查**：PID是否正确
- **检查**：进程是否还在运行
- **检查**：使用 `plist` 确认进程存在

### 问题4：编译错误
- **解决方法**：运行 `make clean && make` 重新编译

---

## 📝 测试记录模板

测试时可以用这个模板记录：

```
测试日期：___________

测试1 - 初始进程列表：
[ ] 通过 / [ ] 失败
备注：________________

测试2 - 运行程序：
[ ] 通过 / [ ] 失败
备注：________________

测试3 - 查看进程列表：
[ ] 通过 / [ ] 失败
备注：________________

测试4 - 停止进程：
[ ] 通过 / [ ] 失败
备注：________________

测试5 - 多进程管理：
[ ] 通过 / [ ] 失败
备注：________________

测试6 - 错误处理：
[ ] 通过 / [ ] 失败
备注：________________
```

---

## 🎓 答辩时如何解释

### 问题：你的进程管理是如何工作的？

**回答要点：**
1. 使用数组结构管理最多5个进程
2. 每个进程有NeuMiniOS自定义的PID和Linux系统PID
3. `run` 命令：从磁盘镜像提取文件 → 创建临时文件 → fork+execl执行
4. `plist` 命令：遍历进程表，显示所有运行中的进程
5. `stop` 命令：查找进程 → 发送SIGTERM信号 → 等待结束 → 更新状态

### 问题：为什么选择数组而不是链表？

**回答要点：**
1. 符合基本要求（最多5个进程，数量固定）
2. 实现简单，性能稳定
3. 内存占用可预测
4. 数组访问速度快

---

**祝你测试顺利！** 🚀

